let InfoBox=function(options){options=options||{};google.maps.OverlayView.apply(this,arguments);this.content=options.content||'';this.disableAutoPan=options.disableAutoPan||false;this.maxWidth=options.maxWidth||0;this.pixelOffset=options.pixelOffset||new google.maps.Size(0,0);this.position=options.position||new google.maps.LatLng(0,0);this.zIndex=options.zIndex||null;this.boxClass=options.boxClass||'infoBox';this.boxStyle=options.boxStyle||{};this.closeBoxMargin=options.closeBoxMargin||'2px';this.closeBoxURL=options.closeBoxURL||'https://www.google.com/intl/en_us/mapfiles/close.gif';if(options.closeBoxURL===''){this.closeBoxURL='';}
this.infoBoxClearance=options.infoBoxClearance||new google.maps.Size(1,1);if(typeof options.visible==='undefined'){if(typeof options.isHidden==='undefined'){options.visible=true;}else{options.visible=!options.isHidden;}}
this.isHidden=!options.visible;this.alignBottom=options.alignBottom||false;this.pane=options.pane||'floatPane';this.enableEventPropagation=options.enableEventPropagation||false;this.container=null;this.moveListener=null;this.fixedWidthSet=null;this.domEventListeners=[];this.cancelEvents=['mousedown','mouseover','mouseout','mouseup','click','dblclick','touchstart','touchend','touchmove'];}
InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.createInfoBoxDiv=function(){let bw,me=this;let cancelHandler=function(event){event.cancelBubble=true;if(event.stopPropagation){event.stopPropagation();}};let ignoreHandler=function(event){event.preventDefault();if(!me.enableEventPropagation){cancelHandler(event);}};if(!this.container){this.container=document.createElement('div');this.clearDomEventListeners();this.setboxStyle();if(typeof this.content.nodeType==='undefined'){this.container.innerHTML=this.content;}else{this.container.appendChild(this.content);}
this.container.prepend(this.getCloseBoxImg());this.getPanes()[this.pane].appendChild(this.container);this.addCloseBox();if(this.container.style.width){this.fixedWidthSet=true;}else{if(this.maxWidth!==0&&this.container.offsetWidth>this.maxWidth){this.container.style.width=this.maxWidth;this.container.style.overflow='auto';this.fixedWidthSet=true;}else{bw=this.getBoxWidths();this.container.style.width=(this.container.offsetWidth-bw.left-bw.right)+'px';this.fixedWidthSet=false;}}
this.panBox(this.disableAutoPan);if(!this.enableEventPropagation){this.cancelEvents.forEach(function(event){me.addDomEventListener(event,cancelHandler);});this.addDomEventListener('mouseover',function(){this.style.cursor='default';});}
this.addDomEventListener('contextmenu',ignoreHandler);google.maps.event.trigger(this,'domready');}};InfoBox.prototype.getCloseBoxImg=function(){let img='';if(this.closeBoxURL!==''){img=document.createElement('img');img.setAttribute('src',this.closeBoxURL);img.style.cursor='pointer';img.style.margin=this.closeBoxMargin;img.style.float='right';}
return img;};InfoBox.prototype.addDomEventListener=function(event,handler,element){let item={element:element||this.container,event:event,handler:handler}
this.domEventListeners.push(item);item.element.addEventListener(item.event,item.handler);};InfoBox.prototype.clearDomEventListeners=function(){this.domEventListeners.forEach(function(item){item.element.removeEventListener(item.event,item.handler);});this.domEventListeners=[];};InfoBox.prototype.addCloseBox=function(){if(this.closeBoxURL!==''){let me=this;this.addDomEventListener('click',function(event){me.closeHandler(event);},this.container.firstChild);}};InfoBox.prototype.closeHandler=function(event){event.cancelBubble=true;event.stopPropagation();google.maps.event.trigger(this,'closeclick');this.close();};InfoBox.prototype.panBox=function(disablePan){let map,xOffset=0,yOffset=0;if(!disablePan){map=this.getMap();if(map instanceof google.maps.Map){if(!map.getBounds().contains(this.position)){map.setCenter(this.position);}
let mapDiv=map.getDiv(),mapWidth=mapDiv.offsetWidth,mapHeight=mapDiv.offsetHeight,iwOffsetX=this.pixelOffset.width,iwOffsetY=this.pixelOffset.height,iwWidth=this.container.offsetWidth,iwHeight=this.container.offsetHeight,padX=this.infoBoxClearance.width,padY=this.infoBoxClearance.height,pixPosition=this.getProjection().fromLatLngToContainerPixel(this.position);if(pixPosition.x<(-iwOffsetX+padX)){xOffset=pixPosition.x+iwOffsetX-padX;}else if((pixPosition.x+iwWidth+iwOffsetX+padX)>mapWidth){xOffset=pixPosition.x+iwWidth+iwOffsetX+padX-mapWidth;}
if(this.alignBottom){if(pixPosition.y<(-iwOffsetY+padY+iwHeight)){yOffset=pixPosition.y+iwOffsetY-padY-iwHeight;}else if((pixPosition.y+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwOffsetY+padY-mapHeight;}}else{if(pixPosition.y<(-iwOffsetY+padY)){yOffset=pixPosition.y+iwOffsetY-padY;}else if((pixPosition.y+iwHeight+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwHeight+iwOffsetY+padY-mapHeight;}}
if(xOffset||yOffset){map.panBy(xOffset,yOffset);}}}};InfoBox.prototype.setboxStyle=function(){let i,boxStyle;if(this.container){this.container.className=this.boxClass;this.container.style.cssText='';boxStyle=this.boxStyle;for(i in boxStyle){if(boxStyle.hasOwnProperty(i)){this.container.style[i]=boxStyle[i];}}
this.container.style.WebkitTransform='translateZ(0)';if(typeof this.container.style.opacity!=='undefined'&&this.container.style.opacity!==''){this.container.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+(this.container.style.opacity*100)+')"';this.container.style.filter='alpha(opacity='+(this.container.style.opacity*100)+')';}
this.container.style.position='absolute';this.container.style.visibility='hidden';if(this.zIndex!==null){this.container.style.zIndex=this.zIndex;}}};InfoBox.prototype.getBoxWidths=function(){let computedStyle,bw={top:0,bottom:0,left:0,right:0},box=this.container;if(document.defaultView&&document.defaultView.getComputedStyle){computedStyle=box.ownerDocument.defaultView.getComputedStyle(box,'');if(computedStyle){bw.top=parseInt(computedStyle.borderTopWidth,10)||0;bw.bottom=parseInt(computedStyle.borderBottomWidth,10)||0;bw.left=parseInt(computedStyle.borderLeftWidth,10)||0;bw.right=parseInt(computedStyle.borderRightWidth,10)||0;}}
return bw;};InfoBox.prototype.onRemove=function(){if(this.container){this.container.parentNode.removeChild(this.container);this.container=null;}};InfoBox.prototype.draw=function(){this.createInfoBoxDiv();let pixPosition=this.getProjection().fromLatLngToDivPixel(this.position);this.container.style.left=(pixPosition.x+this.pixelOffset.width)+'px';if(this.alignBottom){this.container.style.bottom=-(pixPosition.y+this.pixelOffset.height)+'px';}else{this.container.style.top=(pixPosition.y+this.pixelOffset.height)+'px';}
if(this.isHidden){this.container.style.visibility='hidden';}else{this.container.style.visibility='visible';}};InfoBox.prototype.setOptions=function(options){if(typeof options.boxClass!=='undefined'){this.boxClass=options.boxClass;this.setboxStyle();}
if(typeof options.boxStyle!=='undefined'){this.boxStyle=options.boxStyle;this.setboxStyle();}
if(typeof options.content!=='undefined'){this.setContent(options.content);}
if(typeof options.disableAutoPan!=='undefined'){this.disableAutoPan=options.disableAutoPan;}
if(typeof options.maxWidth!=='undefined'){this.maxWidth=options.maxWidth;}
if(typeof options.pixelOffset!=='undefined'){this.pixelOffset=options.pixelOffset;}
if(typeof options.alignBottom!=='undefined'){this.alignBottom=options.alignBottom;}
if(typeof options.position!=='undefined'){this.setPosition(options.position);}
if(typeof options.zIndex!=='undefined'){this.setZIndex(options.zIndex);}
if(typeof options.closeBoxMargin!=='undefined'){this.closeBoxMargin=options.closeBoxMargin;}
if(typeof options.closeBoxURL!=='undefined'){this.closeBoxURL=options.closeBoxURL;}
if(typeof options.infoBoxClearance!=='undefined'){this.infoBoxClearance=options.infoBoxClearance;}
if(typeof options.isHidden!=='undefined'){this.isHidden=options.isHidden;}
if(typeof options.visible!=='undefined'){this.isHidden=!options.visible;}
if(typeof options.enableEventPropagation!=='undefined'){this.enableEventPropagation=options.enableEventPropagation;}
if(this.container){this.draw();}};InfoBox.prototype.setContent=function(content){this.content=content;if(this.container){if(typeof content.nodeType==='undefined'){this.container.innerHTML=content;}else{this.container.appendChild(content);}
this.container.prepend(this.getCloseBoxImg());this.addCloseBox();}
google.maps.event.trigger(this,'contentchanged');};InfoBox.prototype.setPosition=function(latlng){this.position=latlng;if(this.container){this.draw();}
google.maps.event.trigger(this,'positionchanged');};InfoBox.prototype.setZIndex=function(index){this.zIndex=index;if(this.container){this.container.style.zIndex=index;}
google.maps.event.trigger(this,'zIndexchanged');};InfoBox.prototype.setVisible=function(isVisible){this.isHidden=!isVisible;if(this.container){this.container.style.visibility=(this.isHidden?'hidden':'visible');}};InfoBox.prototype.getContent=function(){return this.content;};InfoBox.prototype.getPosition=function(){return this.position;};InfoBox.prototype.getZIndex=function(){return this.zIndex;};InfoBox.prototype.getVisible=function(){let isVisible;if((typeof this.getMap()==='undefined')||(this.getMap()===null)){isVisible=false;}else{isVisible=!this.isHidden;}
return isVisible;};InfoBox.prototype.show=function(){this.isHidden=false;if(this.container){this.container.style.visibility='visible';}};InfoBox.prototype.hide=function(){this.isHidden=true;if(this.container){this.container.style.visibility='hidden';}};InfoBox.prototype.open=function(map,anchor){let me=this;if(anchor){this.position=anchor.getPosition();this.moveListener=google.maps.event.addListener(anchor,'positionchanged',function(){me.setPosition(this.getPosition());});}
this.setMap(map);if(this.container){this.panBox();}};InfoBox.prototype.close=function(){this.clearDomEventListeners();if(this.moveListener){google.maps.event.removeListener(this.moveListener);this.moveListener=null;}
this.setMap(null);};