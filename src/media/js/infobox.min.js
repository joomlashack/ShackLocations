function InfoBox(options){options=options||{};google.maps.OverlayView.apply(this,arguments);this.content_=options.content||'';this.disableAutoPan_=options.disableAutoPan||false;this.maxWidth_=options.maxWidth||0;this.pixelOffset_=options.pixelOffset||new google.maps.Size(0,0);this.position_=options.position||new google.maps.LatLng(0,0);this.zIndex_=options.zIndex||null;this.boxClass_=options.boxClass||'infoBox';this.boxStyle_=options.boxStyle||{};this.closeBoxMargin_=options.closeBoxMargin||'2px';this.closeBoxURL_=options.closeBoxURL||'https://www.google.com/intl/en_us/mapfiles/close.gif';if(options.closeBoxURL===''){this.closeBoxURL_='';}
this.infoBoxClearance_=options.infoBoxClearance||new google.maps.Size(1,1);if(typeof options.visible==='undefined'){if(typeof options.isHidden==='undefined'){options.visible=true;}else{options.visible=!options.isHidden;}}
this.isHidden_=!options.visible;this.alignBottom_=options.alignBottom||false;this.pane_=options.pane||'floatPane';this.enableEventPropagation_=options.enableEventPropagation||false;this.div_=null;this.moveListener_=null;this.fixedWidthSet_=null;this.domEventListeners_=[];this.cancelEvents=['mousedown','mouseover','mouseout','mouseup','click','dblclick','touchstart','touchend','touchmove'];}
InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.createInfoBoxDiv_=function(){let bw,me=this;let cancelHandler=function(event){event.cancelBubble=true;if(event.stopPropagation){event.stopPropagation();}};let ignoreHandler=function(event){event.preventDefault();if(!me.enableEventPropagation_){cancelHandler(event);}};if(!this.div_){this.div_=document.createElement('div');this.clearDomEventListeners();this.setBoxStyle_();if(typeof this.content_.nodeType==='undefined'){this.div_.innerHTML=this.content_;}else{this.div_.appendChild(this.content_);}
this.div_.prepend(this.getCloseBoxImg_());this.getPanes()[this.pane_].appendChild(this.div_);this.addCloseBox_();if(this.div_.style.width){this.fixedWidthSet_=true;}else{if(this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_){this.div_.style.width=this.maxWidth_;this.div_.style.overflow='auto';this.fixedWidthSet_=true;}else{bw=this.getBoxWidths_();this.div_.style.width=(this.div_.offsetWidth-bw.left-bw.right)+'px';this.fixedWidthSet_=false;}}
this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.cancelEvents.forEach(function(event){me.addDomEventListener(event,cancelHandler);});this.addDomEventListener('mouseover',function(){this.style.cursor='default';});}
this.addDomEventListener('contextmenu',ignoreHandler);google.maps.event.trigger(this,'domready');}};InfoBox.prototype.getCloseBoxImg_=function(){let img='';if(this.closeBoxURL_!==''){img=document.createElement('img');img.setAttribute('src',this.closeBoxURL_);img.style.cursor='pointer';img.style.margin=this.closeBoxMargin_;img.style.float='right';}
return img;};InfoBox.prototype.addDomEventListener=function(event,handler,element){let item={element:element||this.div_,event:event,handler:handler}
this.domEventListeners_.push(item);item.element.addEventListener(item.event,item.handler);};InfoBox.prototype.clearDomEventListeners=function(){this.domEventListeners_.forEach(function(item){item.element.removeEventListener(item.event,item.handler);});this.domEventListeners_=[];};InfoBox.prototype.addCloseBox_=function(){if(this.closeBoxURL_!==''){this.addDomEventListener('click',this.closeHandler,this.div_.firstChild);}};InfoBox.prototype.closeHandler=function(event){event.cancelBubble=true;event.stopPropagation();google.maps.event.trigger(this,'closeclick');this.close();};InfoBox.prototype.panBox_=function(disablePan){let map,xOffset=0,yOffset=0;if(!disablePan){map=this.getMap();if(map instanceof google.maps.Map){if(!map.getBounds().contains(this.position_)){map.setCenter(this.position_);}
let mapDiv=map.getDiv(),mapWidth=mapDiv.offsetWidth,mapHeight=mapDiv.offsetHeight,iwOffsetX=this.pixelOffset_.width,iwOffsetY=this.pixelOffset_.height,iwWidth=this.div_.offsetWidth,iwHeight=this.div_.offsetHeight,padX=this.infoBoxClearance_.width,padY=this.infoBoxClearance_.height,pixPosition=this.getProjection().fromLatLngToContainerPixel(this.position_);if(pixPosition.x<(-iwOffsetX+padX)){xOffset=pixPosition.x+iwOffsetX-padX;}else if((pixPosition.x+iwWidth+iwOffsetX+padX)>mapWidth){xOffset=pixPosition.x+iwWidth+iwOffsetX+padX-mapWidth;}
if(this.alignBottom_){if(pixPosition.y<(-iwOffsetY+padY+iwHeight)){yOffset=pixPosition.y+iwOffsetY-padY-iwHeight;}else if((pixPosition.y+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwOffsetY+padY-mapHeight;}}else{if(pixPosition.y<(-iwOffsetY+padY)){yOffset=pixPosition.y+iwOffsetY-padY;}else if((pixPosition.y+iwHeight+iwOffsetY+padY)>mapHeight){yOffset=pixPosition.y+iwHeight+iwOffsetY+padY-mapHeight;}}
if(xOffset||yOffset){map.panBy(xOffset,yOffset);}}}};InfoBox.prototype.setBoxStyle_=function(){let i,boxStyle;if(this.div_){this.div_.className=this.boxClass_;this.div_.style.cssText='';boxStyle=this.boxStyle_;for(i in boxStyle){if(boxStyle.hasOwnProperty(i)){this.div_.style[i]=boxStyle[i];}}
this.div_.style.WebkitTransform='translateZ(0)';if(typeof this.div_.style.opacity!=='undefined'&&this.div_.style.opacity!==''){this.div_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+(this.div_.style.opacity*100)+')"';this.div_.style.filter='alpha(opacity='+(this.div_.style.opacity*100)+')';}
this.div_.style.position='absolute';this.div_.style.visibility='hidden';if(this.zIndex_!==null){this.div_.style.zIndex=this.zIndex_;}}};InfoBox.prototype.getBoxWidths_=function(){let computedStyle,bw={top:0,bottom:0,left:0,right:0},box=this.div_;if(document.defaultView&&document.defaultView.getComputedStyle){computedStyle=box.ownerDocument.defaultView.getComputedStyle(box,'');if(computedStyle){bw.top=parseInt(computedStyle.borderTopWidth,10)||0;bw.bottom=parseInt(computedStyle.borderBottomWidth,10)||0;bw.left=parseInt(computedStyle.borderLeftWidth,10)||0;bw.right=parseInt(computedStyle.borderRightWidth,10)||0;}}
return bw;};InfoBox.prototype.onRemove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null;}};InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();let pixPosition=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=(pixPosition.x+this.pixelOffset_.width)+'px';if(this.alignBottom_){this.div_.style.bottom=-(pixPosition.y+this.pixelOffset_.height)+'px';}else{this.div_.style.top=(pixPosition.y+this.pixelOffset_.height)+'px';}
if(this.isHidden_){this.div_.style.visibility='hidden';}else{this.div_.style.visibility='visible';}};InfoBox.prototype.setOptions=function(options){if(typeof options.boxClass!=='undefined'){this.boxClass_=options.boxClass;this.setBoxStyle_();}
if(typeof options.boxStyle!=='undefined'){this.boxStyle_=options.boxStyle;this.setBoxStyle_();}
if(typeof options.content!=='undefined'){this.setContent(options.content);}
if(typeof options.disableAutoPan!=='undefined'){this.disableAutoPan_=options.disableAutoPan;}
if(typeof options.maxWidth!=='undefined'){this.maxWidth_=options.maxWidth;}
if(typeof options.pixelOffset!=='undefined'){this.pixelOffset_=options.pixelOffset;}
if(typeof options.alignBottom!=='undefined'){this.alignBottom_=options.alignBottom;}
if(typeof options.position!=='undefined'){this.setPosition(options.position);}
if(typeof options.zIndex!=='undefined'){this.setZIndex(options.zIndex);}
if(typeof options.closeBoxMargin!=='undefined'){this.closeBoxMargin_=options.closeBoxMargin;}
if(typeof options.closeBoxURL!=='undefined'){this.closeBoxURL_=options.closeBoxURL;}
if(typeof options.infoBoxClearance!=='undefined'){this.infoBoxClearance_=options.infoBoxClearance;}
if(typeof options.isHidden!=='undefined'){this.isHidden_=options.isHidden;}
if(typeof options.visible!=='undefined'){this.isHidden_=!options.visible;}
if(typeof options.enableEventPropagation!=='undefined'){this.enableEventPropagation_=options.enableEventPropagation;}
if(this.div_){this.draw();}};InfoBox.prototype.setContent=function(content){this.content_=content;if(this.div_){if(typeof content.nodeType==='undefined'){this.div_.innerHTML=content;}else{this.div_.appendChild(content);}
this.div_.prepend(this.getCloseBoxImg_());this.addCloseBox_();}
google.maps.event.trigger(this,'content_changed');};InfoBox.prototype.setPosition=function(latlng){this.position_=latlng;if(this.div_){this.draw();}
google.maps.event.trigger(this,'position_changed');};InfoBox.prototype.setZIndex=function(index){this.zIndex_=index;if(this.div_){this.div_.style.zIndex=index;}
google.maps.event.trigger(this,'zindex_changed');};InfoBox.prototype.setVisible=function(isVisible){this.isHidden_=!isVisible;if(this.div_){this.div_.style.visibility=(this.isHidden_?'hidden':'visible');}};InfoBox.prototype.getContent=function(){return this.content_;};InfoBox.prototype.getPosition=function(){return this.position_;};InfoBox.prototype.getZIndex=function(){return this.zIndex_;};InfoBox.prototype.getVisible=function(){let isVisible;if((typeof this.getMap()==='undefined')||(this.getMap()===null)){isVisible=false;}else{isVisible=!this.isHidden_;}
return isVisible;};InfoBox.prototype.show=function(){this.isHidden_=false;if(this.div_){this.div_.style.visibility='visible';}};InfoBox.prototype.hide=function(){this.isHidden_=true;if(this.div_){this.div_.style.visibility='hidden';}};InfoBox.prototype.open=function(map,anchor){let me=this;if(anchor){this.position_=anchor.getPosition();this.moveListener_=google.maps.event.addListener(anchor,'position_changed',function(){me.setPosition(this.getPosition());});}
this.setMap(map);if(this.div_){this.panBox_();}};InfoBox.prototype.close=function(){this.clearDomEventListeners();if(this.moveListener_){google.maps.event.removeListener(this.moveListener_);this.moveListener_=null;}
this.setMap(null);};